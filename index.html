<!DOCTYPE html>
  <html lang="en" dir="ltr">
    <head>
      <meta charset="utf-8">
      <title>Duncan's Language Translator</title>
    </head>
    <body>
      <style>
        img {
          max-height: 50px;
          width: auto;
        }
      </style>
      <div id="text-entry">
        <form id="theform">
          <p><label for="english">Enter English word or phrase:</label></p>
          <p><input type="text" id="english" name="english"></p>
          <p><input type="submit" id="submit" value="Translate!"></p>
        </form>
      </div><br>
      <div id="output">
      </div>
      <hr>
      Intermediate Language key:
      <table>
        <tr>
          <th>English Sound</th>
          <th>English Example</th>
          <th>International Phonetic Alphabet</th>
          <th>Intermediate Language</th>
        </tr>
        <tr>
          <td>i</td>
          <td>bit</td>
          <td>ɪ</td>
          <td>i</td>
        </tr>
        <tr>
          <td>e</td>
          <td>bet</td>
          <td>ɛ</td>
          <td>e</td>
        </tr>
      </table>
      <hr>
      <div id="il-entry">
        <form id="ilform">
          <p><label for="il">Enter Intermediate Language word:</label></p>
          <p><input type="text" id="il" name="il"></p>
          <p><input type="submit" id="il-submit" value="Make Image!"></p>
        </form>
      </div><br>
      <div id="il-output">
      </div>
      
      
      <script>
        function produceImage(il, ilOutputDiv) {
          console.log('Producing Image!')
          for (let i = 0; i < il.length; i++) {
            const char = il[i]
            const uppercase = 'AEIOUQNTHJS'
            if (uppercase.includes(char)) {
              const doubled = char.toLowerCase() + char.toLowerCase()
              console.log(`Filename: ${doubled}.jpg`)
              ilOutputDiv.innerHTML += `<img src=\"${doubled}.jpg\">`
              continue;
            }
            const lowercase = 'aeiounmbpdtgkvfszhwyrlcj'
            if (lowercase.includes(char)) {
              console.log(`Filename: ${char}.jpg`)
              ilOutputDiv.innerHTML += `<img src=\"${char}.jpg\">`
              continue;
            }
            console.log(`Unexpected character ${char}`)
          }
          console.log(`output is now ${ilOutputDiv.innerHTML}`)
        }
        
        function makeImage(event) {
           event.preventDefault();
           console.log('Making Image!')
           let il = document.getElementById('il').value
           console.log(`Input IL word is ${il}`)
           let ilOutputDiv = document.getElementById('il-output')
           produceImage(il, ilOutputDiv)
           console.log('Done Making Image')
        }
        
        function convertToRoman(phonetic, outputDiv) {
          console.log("Converting!")
          for (let j = 0; j < phonetic.length; j++) {
            const char = phonetic.substr(j, j+1)
            console.log(`At position ${j} we have ${char}`)
          }
                     
          console.log("No seriously, converting!")
          for (let i = 0; i < phonetic.length; i++) {
            console.log(`Scanning position ${i}`)
            // is there a two-character match?
            if (i < phonetic.length - 1) {
               const twochar = phonetic.substr(i, i+2)
               console.log(`Potential twochar is ${twochar}`)
               i++
               switch (twochar) {
                 case 'ʌɪ':
                   console.log('matched ʌɪ')
                    break;
                 case 'uː':
                   console.log('matched u:')
                   break;
                 case 'eɪ':
                   console.log('matched eɪ')
                   break;
                 case 'ɔː':
                   console.log('matched ɔː')
                   break;
                 case 'iː':
                   console.log('matched iː')
                   break;
                 case 'o:':
                 case 'ɐ̟ʉ':
                 case 'əʊ':
                   console.log('matched one of the complicated long o sounds')
                   break;
                 case 'aʊ':
                   console.log('matched aʊ')
                   break;
                 case 'ɛʊ':
                   console.log('matched ɛʊ')
                   break;
                 case 'e:':
                   console.log('matched e:')
                   break;
                 case 'a:':
                   console.log('matched a:')
                   break;
                 case 'tʃ':
                   console.log('matched tʃ')
                   break;
                 case 'dʒ':
                   console.log('matched dʒ')
                   break;
                 case 'ks':
                   console.log('matched ks')
                   break;
                 default:
                   console.log('Did not match any two-character sequences')
                   i--
               }
            }
            
            // is there a one-character match?
            switch (phonetic[i]) {
              case '(':
              case ')':
              case 'ˈ':
              case 'ˌ':
                console.log('Skipped unimportant character')
                break;
              default:
                console.log(`matched ${phonetic[i]}`)
            }
          }
        }
        
        function fetchDict(english, outputDiv) {
          console.log(`Attempting to fetch https://api.dictionaryapi.dev/api/v2/entries/en/${english}`)
          fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${english}`)
           .then((response) => {
             if (!response.ok) {
               throw new Error(`HTTP error: ${response.status}`);
             }
           return response.text();
           })
           .then((text) => {
           const commaSplit = text.split(',')
           const colonSplit = commaSplit[1].split(':')
           const phonetic = colonSplit[1]
           const trimmedPhonetic = phonetic.substring(2, phonetic.length - 2)
           console.log(`phonetic: ${trimmedPhonetic}`)
           outputDiv.innerHTML += `<p> Phonetic: ${trimmedPhonetic} </p>`
           convertToRoman(trimmedPhonetic, outputDiv)
        })
       .catch((error) => { dictText = `Could not fetch dictionary: ${error}` });
       }

       function translate(event) {
         event.preventDefault();
         console.log('Translating!')
         let english = document.getElementById('english').value
         console.log(`Input english word is ${english}`)
         let outputDiv = document.getElementById('output')
         fetchDict(english, outputDiv)
         console.log('Did we fetch that dict?')
       }
       
        const ilform = document.getElementById('ilform');
        ilform.addEventListener('submit',makeImage);
        const form = document.getElementById('theform');
        form.addEventListener('submit',translate);
      </script>
    </body>
</html>
